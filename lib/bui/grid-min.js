/**
 * @fileOverview \u8868\u683c\u547d\u540d\u7a7a\u95f4\u5165\u53e3
 * @ignore
 */define("bui/grid",["bui/common","bui/grid/simplegrid","bui/grid/grid","bui/grid/column","bui/grid/header","bui/grid/format","bui/grid/plugins"],function(e){var t=e("bui/common"),n=t.namespace("Grid");return t.mix(n,{SimpleGrid:e("bui/grid/simplegrid"),Grid:e("bui/grid/grid"),Column:e("bui/grid/column"),Header:e("bui/grid/header"),Format:e("bui/grid/format"),Plugins:e("bui/grid/plugins")}),n}),define("bui/grid/simplegrid",["bui/common","bui/list"],function(e){var t=e("bui/common"),n=e("bui/list"),r=t.Component,i=r.UIBase,s=t.prefix,o=s+"grid",u=o+"-row",a=s+"grid-row-odd",f=s+"grid-row-even",l=s+"grid-border",c=s+"grid-row-first",h=n.SimpleListView.extend({setColumns:function(e){var n=this,r=n.get("headerRowEl");e=e||n.get("columns"),r.empty(),t.each(e,function(e){n._createColumn(e,r)})},_createColumn:function(e,n){var r=this,i=t.substitute(r.get("columnTpl"),e);$(i).appendTo(n)},getItemTpl:function(e,n){var r=this,i=r.get("columns"),s=r.get("rowTpl"),o=n%2===0?a:f,u=[],l;return t.each(i,function(t){var n=t.dataIndex;u.push(r._getCellTpl(t,n,e))}),s=t.substitute(s,{cellsTpl:u.join(""),oddCls:o}),s},_getCellTpl:function(e,n,r){var i=this,s=e.renderer,o=s?s(r[n],r):r[n],u=i.get("cellTpl");return t.substitute(u,{elCls:e.elCls,text:o})},clearData:function(){var e=this,t=e.get("itemContainer");t.empty()},showData:function(e){var n=this;t.each(e,function(e,t){n._createRow(e,t)})},_uiSetInnerBorder:function(e){var t=this,n=t.get("el");e?n.addClass(l):n.removeClass(l)},_uiSetTableCls:function(e){var t=this,n=t.get("el").find("table");n.attr("class",e)}},{ATTRS:{headerRowEl:{valueFn:function(){var e=this,t=e.get("el").find("thead");return t.children("tr")}},itemContainer:{valueFn:function(){return this.get("el").find("tbody")}},tableCls:{}}},{xclass:"simple-grid-veiw"}),p=t.List.SimpleList.extend({renderUI:function(){this.get("view").setColumns()},bindUI:function(){var e=this,t=e.get("itemCls"),n=t+"-hover",r=e.get("el");r.delegate("."+t,"mouseover",function(e){var t=$(e.currentTarget);t.addClass(n)}).delegate("."+t,"mouseout",function(e){var t=$(e.currentTarget);t.removeClass(n)})},showData:function(e){this.clearData(),this.set("items",e)},clearData:function(){this.get("view").clearData()},_uiSetColumns:function(e){var t=this;t.clearData(),t.get("view").setColumns(e)}},{ATTRS:{itemCls:{view:!0,value:u},tableCls:{view:!0,value:o+"-table"},columns:{view:!0,sync:!1,value:[]},tpl:{view:!0,value:'<table cellspacing="0" class="{tableCls}" cellpadding="0"><thead><tr></tr></thead><tbody></tbody></table>'},innerBorder:{view:!0,value:!0},rowTpl:{view:!0,value:'<tr class="'+u+' {oddCls}">{cellsTpl}</tr>'},cellTpl:{view:!0,value:'<td class="'+o+'-cell {elCls}"><div class="'+o+'-cell-inner"><span class="'+o+'-cell-text">{text}</span></div></td>'},columnTpl:{view:!0,value:'<th class="'+o+'-hd {elCls}" width="{width}"><div class="'+o+'-hd-inner"><span class="'+o+'-hd-title">{title}</span></div></th>'},events:{value:{}},xview:{value:h}}},{xclass:"simple-grid"});return p.View=h,p}),define("bui/grid/column",["bui/common"],function(e){var t=e("bui/common"),n=t.prefix,r=n+"grid-hd-title",i=n+"grid-hd-open",s="sort-",o="ASC",u="DESC",a=n+"grid-hd-menu-trigger",f="grid-hd-menu-trigger",l=t.Component.View.extend({setTplContent:function(e){var t=this,n=t.get("sortTpl"),i=t.get("triggerTpl"),s=t.get("el"),o;l.superclass.setTplContent.call(t,e),o=s.find("."+r),$(n).insertAfter(o),$(i).insertAfter(o)},_setContent:function(){this.setTplContent()},_uiSetShowMenu:function(e){var t=this,n=t.get("triggerTpl"),i=t.get("el"),s=i.find("."+r);e?$(n).insertAfter(s):i.find("."+a).remove()},_uiSetTitle:function(e){if(!this.get("rendered"))return;this._setContent()},_uiSetDraggable:function(e){if(!this.get("rendered"))return;this._setContent()},_uiSetSortable:function(e){if(!this.get("rendered"))return;this._setContent()},_uiSetTpl:function(e){if(!this.get("rendered"))return;this._setContent()},_uiSetSortState:function(e){var t=this,n=t.get("el"),r=e?"addClass":"removeClass",i=s+"asc",o=s+"desc";n.removeClass(i+" "+o),e==="ASC"?n.addClass(i):e==="DESC"&&n.addClass(o)},_uiSetOpen:function(e){var t=this,n=t.get("el");e?n.addClass(i):n.removeClass(i)}},{ATTRS:{sortTpl:{view:!0,getter:function(){var e=this,t=e.get("sortable");return t?'<span class="'+n+'grid-sort-icon">&nbsp;</span>':""}},tpl:{}}}),c=t.Component.Controller.extend({_toggleSortState:function(){var e=this,t=e.get("sortState"),n=t?t===o?u:o:o;e.set("sortState",n)},performActionInternal:function(e){var t=this,n=$(e.target),r=t.get("prefixCls");n.hasClass(r+f)||t.get("sortable")&&t._toggleSortState()},_uiSetWidth:function(e){e&&this.set("originWidth",e)}},{ATTRS:{elTagName:{value:"th"},open:{view:!0,value:!1},dataIndex:{view:!0,value:""},draggable:{sync:!1,view:!0,value:!0},editor:{},focusable:{value:!1},fixed:{value:!1},id:{},renderer:{},resizable:{value:!0},sortable:{sync:!1,view:!0,value:!0},sortState:{view:!0,value:null},title:{sync:!1,view:!0,value:"&#160;"},width:{value:100},showMenu:{view:!0,value:!1},triggerTpl:{view:!0,value:'<span class="'+a+'"></span>'},tpl:{sync:!1,view:!0,value:'<div class="'+n+'grid-hd-inner">'+'<span class="'+r+'">{title}</span>'+"</div>"},cellTpl:{value:""},events:{value:{afterWidthChange:!0,afterSortStateChange:!0,afterVisibleChange:!0,click:!0,resize:!0,move:!0}},xview:{value:l}}},{xclass:"grid-hd",priority:1});return c.Empty=c.extend({},{ATTRS:{type:{value:"empty"},sortable:{view:!0,value:!1},width:{view:!0,value:null},tpl:{view:!0,value:'<div class="'+n+'grid-hd-inner"></div>'}}},{xclass:"grid-hd-empty",priority:1}),c}),define("bui/grid/header",["bui/common","bui/grid/column"],function(e){var t=e("bui/common"),n=t.prefix,r=t.namespace("Grid"),i=e("bui/grid/column"),s=t.Component.View,o=t.Component.Controller,u=17,a=t.UA,f=s.extend({getContentElement:function(){return this.get("el").find("tr")},scrollTo:function(e){var t=this,n=t.get("el");e.top!==undefined&&n.scrollTop(e.top),e.left!==undefined&&n.scrollLeft(e.left)},_uiSetTableCls:function(e){var t=this,n=t.get("el").find("table");n.attr("class",e)}},{ATTRS:{emptyCellEl:{},tableCls:{}}},{xclass:"header-view"}),l=o.extend({addColumn:function(e,t){var n=this,r=t,i=n.get("columns");return e=n._createColumn(e),t===undefined&&(t=i.length,r=n.get("children").length-1),i.splice(t,0,e),n.addChild(e,r),n.fire("add",{column:e,index:t}),e},removeColumn:function(e){var n=this,r=n.get("columns"),i;return e=t.isNumber(e)?r[e]:e,i=t.Array.indexOf(e,r),r.splice(i,1),n.fire("remove",{column:e,index:i}),n.removeChild(e,!0)},bindUI:function(){var e=this;e._bindColumnsEvent()},initializer:function(){var e=this,t=e.get("children"),n=e.get("columns"),r;$.each(n,function(r,i){var s=e._createColumn(i);t[r]=s,n[r]=s}),r=e._createEmptyColumn(),t.push(r),e.set("emptyColumn",r)},getColumns:function(){return this.get("columns")},getColumnsWidth:function(){var e=this,t=e.getColumns(),n=0;return $.each(t,function(e,t){t.get("visible")&&(n+=t.get("el").outerWidth())}),n},getColumnOriginWidth:function(){var e=this,t=e.getColumns(),n=0;return $.each(t,function(e,t){if(t.get("visible")){var r=t.get("originWidth")||t.get("width");n+=r}}),n},getColumnByIndex:function(e){var t=this,n=t.getColumns(),r=n[e];return r},getColumn:function(e){var t=this,n=t.getColumns(),r=null;return $.each(n,function(t,n){if(e(n))return r=n,!1}),r},getColumnById:function(e){var t=this;return t.getColumn(function(t){return t.get("id")===e})},getColumnIndex:function(e){var n=this,r=n.getColumns();return t.Array.indexOf(e,r)},scrollTo:function(e){this.get("view").scrollTo(e)},_bindColumnsEvent:function(){var e=this;e.on("afterWidthChange",function(t){var n=t.target;n!==e&&e.setTableWidth()}),e.on("afterVisibleChange",function(t){var n=t.target;n!==e&&e.setTableWidth()}),e.on("afterSortStateChange",function(t){var n=t.target,r=e.getColumns(),i=t.newVal;i&&$.each(r,function(e,t){t!==n&&t.set("sortState","")})}),e.on("add",function(){e.setTableWidth()}),e.on("remove",function(){e.setTableWidth()})},_createColumn:function(e){return e instanceof i?e:(e.id||(e.id=t.guid("col")),new i(e))},_createEmptyColumn:function(){return new i.Empty},_isAllowScrollLeft:function(){var e=this,t=e.get("parent");return t&&!!t.get("height")},forceFitColumns:function(){function l(e,t){var n=e.get("el");e.set("width",t,{silent:1}),n.width(t)}var e=this,t=e.getColumns(),n=e.get("width"),r=n,i=e.getColumnOriginWidth(),s=0,o=0,a=null,f=e._isAllowScrollLeft();if(n){f&&(n-=u,r=n);var c=0;$.each(t,function(e,t){t.get("visible")&&t.get("resizable")&&c++;if(t.get("visible")&&!t.get("resizable")){var n=t.get("el").outerWidth();r-=n,i-=n}});var h=Math.floor(r/c),p=r/i;if(p===1)return;$.each(t,function(t,n){if(n.get("visible")&&n.get("resizable")){var r=e._getColumnBorderWith(n,t),i=n.get("originWidth");i||(n.set("originWidth",n.get("width")),i=n.get("width")),h=Math.floor((i+r)*p),l(n,h-r),s+=h,a=n}}),a&&(o=r-s,l(a,a.get("width")+o)),e.fire("forceFitWidth")}},_getColumnBorderWith:function(e,t){var n=e.get("el"),r=Math.round(parseFloat(n.css("border-left-width"))||0)+Math.round(parseFloat(n.css("border-right-width"))||0);return r=a.ie&&a.ie<8?t===0?1:r:r,r},setTableWidth:function(){var e=this,t=e.get("width"),n=0,r=null;if(t=="auto")return;e.get("forceFit")?e.forceFitColumns():e._isAllowScrollLeft()&&(n=e.getColumnsWidth(),r=e.get("emptyColumn"),t<n?r.get("el").width(u):r.get("el").width("auto"))},_uiSetWidth:function(){var e=this;e.setTableWidth()},_uiSetForceFit:function(e){var t=this;e&&t.setTableWidth()}},{ATTRS:{columns:{value:[]},emptyColumn:{},focusable:{value:!1},forceFit:{sync:!1,view:!0,value:!1},tpl:{view:!0,value:'<table cellspacing="0" class="'+n+'grid-table" cellpadding="0">'+"<thead><tr></tr></thead>"+"</table>"},tableCls:{view:!0},xview:{value:f},events:{value:{add:!1,remove:!1}}}},{xclass:"grid-header",priority:1});return l}),define("bui/grid/grid",["bui/common","bui/mask","bui/toolbar","bui/list","bui/grid/header","bui/grid/column"],function(e){function f(e){return t.isString(e)?e.indexOf("%")!==-1:!1}function P(e){var n=this;return t.isNumber(e)&&(e-=_),e}var t=e("bui/common"),n=e("bui/mask"),r=t.UA,i=t.Component,s=e("bui/toolbar"),o=e("bui/list"),u=e("bui/grid/header"),a=e("bui/grid/column"),l=t.prefix,c=l+"grid-header-container",h=l+"grid-body",p=l+"grid-width",d=l+"grid-height",v=l+"grid-border",m=l+"grid-tbar",g=l+"grid-bbar",y=l+"grid-button-bar",b=l+"grid-strip",w=l+"grid-row",E=l+"grid-row-odd",S=l+"grid-row-even",x=l+"grid-row-first",T=l+"grid-cell",N=l+"grid-cell-inner",C="grid-td-",k=l+"grid-cell-text",L=l+"grid-cell-empty",A="17",O=l+"hidden",M="data-column-field",_=2,D=1,H=o.SimpleListView.extend({renderUI:function(){var e=this,t=e.get("el"),n=t.find("."+h);e.set("bodyEl",n),e._setTableTpl()},getItemTpl:function(e,n){var r=this,i=r._getColumns(),s=r.get("tbodyEl"),o=r.get("rowTpl"),u=n%2===0?E:S,a=[],f;return t.each(i,function(t){var i=t.get("dataIndex");a.push(r._getCellTpl(t,i,e,n))}),r.get("useEmptyCell")&&a.push(r._getEmptyCellTpl()),o=t.substitute(o,{cellsTpl:a.join(""),oddCls:u}),o},findRow:function(e){var t=this;return $(t.findElement(e))},findCell:function(e,t){var n=C+e;return t.find("."+n)},resetHeaderRow:function(){if(!this.get("useHeaderRow"))return;var e=this,t=e.get("headerRowEl"),n=e.get("tbodyEl");t&&t.remove(),t=e._createHeaderRow(),t.prependTo(n),e.set("headerRowEl",t)},resetColumnsWidth:function(e,t){var n=this,r=n.get("headerRowEl"),i=n.findCell(e.get("id"),r);t=t||e.get("width"),i&&i.width(t),n.setTableWidth()},setTableWidth:function(e){if(!e&&f(this.get("width"))){this.get("tableEl").width("100%");return}var t=this,n=t._getInnerWidth(),i=t.get("height"),s=t.get("tableEl"),o=t.get("forceFit"),u=t.get("headerRowEl");if(!f(e)){e=e||t._getColumnsWidth();if(!n)return;if(n>=e){e=n;if(i){var a=r.ie==6||r.ie==7?A+2:A;e=n-a}}}s.width(e)},setBodyWidth:function(e){var t=this,n=t.get("bodyEl");e=e||t._getInnerWidth(),n.width(e)},setBodyHeight:function(e){var n=this,r=n.get("bodyEl"),i=e,s=r.siblings();t.each(s,function(e){$(e).css("display")!=="none"&&(i-=$(e).outerHeight())}),r.height(i)},setColumnVisible:function(e){var t=this,n=!e.get("visible"),r=e.get("id"),i=t.get("tbodyEl"),s=$("."+C+r,i);n?s.hide():s.show()},updateItem:function(e){var n=this,r=n.getItems(),i=t.Array.indexOf(e,r),s=n._getColumns(),o=null,u;if(i>=0)return o=n.findElement(e),t.each(s,function(t){var r=n.findCell(t.get("id"),$(o)),s=r.find("."+N),u=n._getCellText(t,e,i);s.html(u)}),o},showEmptyText:function(){var e=this,t=e.get("bodyEl"),n=e.get("emptyDataTpl"),r=e.get("emptyEl");r&&r.remove();var r=$(n).appendTo(t);e.set("emptyEl",r)},clearEmptyText:function(){var e=this,t=e.get("emptyEl");t&&t.remove()},_createHeaderRow:function(){var e=this,n=e._getColumns(),r=e.get("tbodyEl"),i=e.get("headerRowTpl"),s,o=[];return $.each(n,function(t,n){o.push(e._getHeaderCellTpl(n))}),e.get("useEmptyCell")&&o.push(e._getEmptyCellTpl()),i=t.substitute(i,{cellsTpl:o.join("")}),s=$(i).appendTo(r),s},_getColumnsWidth:function(){var e=this,n=e.get("columns"),r=0;return t.each(n,function(e){e.get("visible")&&(r+=e.get("el").outerWidth())}),r},_getColumns:function(){return this.get("columns")},_getCellText:function(e,n,r){var i=this,s=e.get("dataIndex"),o=e.get("cellTpl")||i.get("cellTextTpl"),u=i._getCellInnerText(e,s,n,r);return t.substitute(o,{text:u,tips:i._getTips(e,s,n)})},_getCellInnerText:function(e,t,n,r){try{var i=this,s=e.get("renderer"),o=s?s(n[t],n,r):n[t];return o==null?"":o}catch(u){throw"column:"+e.get("title")+" fomat error!"}},_getCellTpl:function(e,n,r,i){var s=this,o=s._getCellText(e,r,i),u=s.get("cellTpl");return t.substitute(u,{elCls:e.get("elCls"),id:e.get("id"),dataIndex:n,cellText:o,hideCls:e.get("visible")?"":O})},_getEmptyCellTpl:function(){return'<td class="'+T+" "+L+'">&nbsp;</td>'},_getHeaderCellTpl:function(e){var n=this,r=n.get("headerCellTpl");return t.substitute(r,{id:e.get("id"),width:e.get("width"),hideCls:e.get("visible")?"":O})},_getInnerWidth:function(){return P(this.get("width"))},_getTips:function(e,n,r){var i=e.get("showTip"),s="";return i&&(s=r[n],t.isFunction(i)&&(s=i(s,r))),s},_uiSetInnerBorder:function(e){var t=this,n=t.get("el");e?n.addClass(v):n.removeClass(v)},_setTableTpl:function(e){var t=this,n=t.get("bodyEl");e=e||t.get("tableTpl"),$(e).appendTo(n);var r=n.find("table"),i=n.find("tbody");t.set("tableEl",r),t.set("tbodyEl",i),t.set("itemContainer",i),t._setTableCls(t.get("tableCls"))},_uiSetTableCls:function(e){this._setTableCls(e)},_uiSetHeight:function(e){var t=this,n=t.get("bodyEl");t.get("el").height(e),t.get("el").addClass(d)},_uiSetWidth:function(e){var t=this;t.get("el").width(e),t.setBodyWidth(t._getInnerWidth(e)),t.get("el").addClass(p)},_uiSetStripeRows:function(e){var t=this,n=e?"addClass":"removeClass";t.get("el")[n](b)},_setTableCls:function(e){var t=this,n=t.get("tableEl");n.attr("class",e)}},{ATTRS:{tableCls:{},bodyEl:{},tbodyEl:{},headerRowEl:{},tableEl:{},emptyEl:{}}},{xclass:"grid-view"}),B=o.SimpleList.extend({createDom:function(){var e=this,t=e.get("render"),n=$(t).width(),r=e.get("width");if(!r&&n){var i=e.getAppendWidth();e.set("width",n-i)}e.get("width")&&e.get("el").addClass(p),e.get("height")&&e.get("el").addClass(d),e.get("innerBorder")&&e.get("el").addClass(v)},renderUI:function(){var e=this;e._initHeader(),e._initBars(),e._initLoadMask(),e.get("view").resetHeaderRow()},bindUI:function(){var e=this;e._bindHeaderEvent(),e._bindBodyEvent(),e._bindItemsEvent()},addColumn:function(e,t){var n=this,r=n.get("header");return r?e=r.addColumn(e,t):(e=new a(e),n.get("columns").splice(t,0,e)),e},clearData:function(){this.clearItems()},getRecords:function(){return this.getItems()},findColumn:function(e){var n=this,r=n.get("header");return t.isNumber(e)?r.getColumnByIndex(e):r.getColumnById(e)},findColumnByField:function(e){var t=this,n=t.get("header");return n.getColumn(function(t){return t.get("dataIndex")===e})},findCell:function(e,t){var n=this,r=null;return t instanceof $?r=t:r=n.findRow(t),r?n.get("view").findCell(e,r):null},findRow:function(e){var t=this;return t.get("view").findRow(e)},removeColumn:function(e){var t=this;t.get("header").removeColumn(e)},showData:function(e){var t=this;t.set("items",e)},resetColumns:function(){var e=this,t=e.get("store");e.get("view").resetHeaderRow(),t&&e.onLoad()},_bindScrollEvent:function(){var e=this,t=e.get("el"),n=t.find("."+h),r=e.get("header");n.on("scroll",function(){var t=n.scrollLeft(),i=n.scrollTop();r.scrollTo({left:t,top:i}),e.fire("scroll",{scrollLeft:t,scrollTop:i,bodyWidth:n.width(),bodyHeight:n.height()})})},_bindHeaderEvent:function(){var e=this,t=e.get("header"),n=e.get("view"),r=e.get("store");t.on("afterWidthChange",function(e){var r=e.target;r!==t&&n.resetColumnsWidth(r)}),t.on("afterSortStateChange",function(e){var t=e.target,n=e.newVal;n&&r&&r.sort(t.get("dataIndex"),t.get("sortState"))}),t.on("afterVisibleChange",function(r){var i=r.target;i!==t&&(n.setColumnVisible(i),e.fire("columnvisiblechange",{column:i}))}),t.on("click",function(n){var r=n.target;r!==t&&e.fire("columnclick",{column:r,domTarget:n.domTarget})}),t.on("forceFitWidth",function(){e.get("rendered")&&e.resetColumns()}),t.on("add",function(t){e.get("rendered")&&(e.fire("columnadd",{column:t.column,index:t.index}),e.resetColumns())}),t.on("remove",function(t){e.get("rendered")&&(e.resetColumns(),e.fire("columnremoved",{column:t.column,index:t.index}))})},_bindBodyEvent:function(){var e=this;e._bindScrollEvent()},_bindItemsEvent:function(){function n(e){return{record:e.item,row:e.domTarget,domTarget:e.domTarget}}var e=this,t=e.get("store");e.on("itemsshow",function(){e.fire("aftershow")}),e.on("itemsclear",function(){e.fire("clear")}),e.on("itemclick",function(t){var n=t.domTarget,r=t.item,i=$(n).closest("."+T),s=$(n).closest("."+w),o;return i.length&&(o=e.fire("cellclick",{record:r,row:s[0],cell:i[0],field:i.attr(M),domTarget:n,domEvent:t.domEvent})),o===!1?o:e.fire("rowclick",{record:r,row:s[0],domTarget:n})}),e.on("itemunselected",function(t){e.fire("rowunselected",n(t))}),e.on("itemselected",function(t){e.fire("rowselected",n(t))}),e.on("itemrendered",function(t){e.fire("rowcreated",n(t))}),e.on("itemremoved",function(t){e.fire("rowremoved",n(t))}),e.on("itemupdated",function(t){e.fire("rowupdated",n(t))})},_getInnerWidth:function(e){return e=e||this.get("width"),P(e)},_initHeader:function(){var e=this,t=e.get("header"),n=e.get("el").find("."+c);t||(t=(new u({columns:e.get("columns"),tableCls:e.get("tableCls"),forceFit:e.get("forceFit"),width:e._getInnerWidth(),render:n,parent:e})).render(),e.set("header",t))},_initBars:function(){var e=this,t=e.get("bbar"),n=e.get("tbar");e._initBar(t,g,"bbar"),e._initBar(n,m,"tbar")},_initBar:function(e,n,r){var s=this,o=null,u=null;if(e){!e.xclass&&!(e instanceof i.Controller)&&(e.xclass="bar",e.children=e.children||[],e.items&&(e.children.push({xclass:"bar",defaultChildClass:"bar-item-button",elCls:y,children:e.items}),e.items=null),e.pagingBar&&(o=s.get("store"),u={xclass:"pagingbar",store:o,pageSize:o.pageSize},e.pagingBar!==!0&&(u=t.merge(u,e.pagingBar)),e.children.push(u)));if(e.xclass){var a=s.get("el").find("."+n);a.show(),e.render=a,e.elTagName="div",e.autoRender=!0,e=s.addChild(e)}s.set(r,e)}return e},_initLoadMask:function(){var e=this,n=e.get("loadMask");n&&!n.show&&(n=new t.Mask.LoadMask({el:e.get("el")}),e.set("loadMask",n))},_uiSetWidth:function(e){var t=this;t.get("rendered")&&(f(e)?t.get("header").set("width","100%"):t.get("header").set("width",t._getInnerWidth(e))),t.get("view").setTableWidth()},_uiSetForceFit:function(e){var t=this;t.get("header").set("forceFit",e)},_uiSetHeight:function(e,t){var n=this,r=n.get("header");n.get("view").setBodyHeight(e),n.get("rendered")&&(n.get("forceFit")&&!t.prevVal&&(r.forceFitColumns(),n.get("view").setTableWidth()),r.setTableWidth())},onLoad:function(){var e=this,t=e.get("store");B.superclass.onLoad.call(this),e.get("emptyDataTpl")&&(t&&t.getCount()==0?e.get("view").showEmptyText():e.get("view").clearEmptyText())}},{ATTRS:{header:{},bbar:{},itemCls:{value:w},columns:{view:!0,value:[]},forceFit:{sync:!1,view:!0,value:!1},emptyDataTpl:{view:!0},headerRowTpl:{view:!0,value:'<tr class="'+l+'grid-header-row">{cellsTpl}</tr>'},headerCellTpl:{view:!0,value:'<td class="{hideCls} '+C+'{id}" width="{width}" style="height:0"></td>'},rowTpl:{view:!0,value:'<tr class="'+w+' {oddCls}">{cellsTpl}</tr>'},cellTpl:{view:!0,value:'<td  class="{elCls} {hideCls} '+T+" "+C+'{id}" data-column-id="{id}" data-column-field = "{dataIndex}" >'+'<div class="'+N+'" >{cellText}</div>'+"</td>"},cellTextTpl:{view:!0,value:'<span class="'+k+' " title = "{tips}">{text}</span>'},events:{value:{aftershow:!1,clear:!1,cellclick:!1,columnclick:!1,rowclick:!1,rowcreated:!1,rowremoved:!1,rowselected:!1,rowunselected:!1,scroll:!1}},stripeRows:{view:!0,value:!0},tbar:{},tableCls:{view:!0,sync:!1,value:l+"grid-table"},tableTpl:{view:!0,value:'<table cellspacing="0" cellpadding="0" ><tbody></tbody></table>'},tpl:{value:'<div class="'+m+'" style="display:none"></div><div class="'+c+'"></div><div class="'+h+'"></div><div style="display:none" class="'+g+'"></div>'},innerBorder:{sync:!1,value:!0},useEmptyCell:{view:!0,value:!0},useHeaderRow:{view:!0,value:!0},xview:{value:H}}},{xclass:"grid"});return B.View=H,B}),define("bui/grid/format",function(e){function t(e){return e<10?"0"+e:e}var n={dateRenderer:function(e){if(!e)return"";if(BUI.isString(e))return e;var n=null;try{n=new Date(e)}catch(r){return""}return!n||!n.getFullYear?"":n.getFullYear()+"-"+t(n.getMonth()+1)+"-"+t(n.getDate())},datetimeRenderer:function(e){if(!e)return"";if(BUI.isString(e))return e;var n=null;try{n=new Date(e)}catch(r){return""}return!n||!n.getFullYear?"":n.getFullYear()+"-"+t(n.getMonth()+1)+"-"+t(n.getDate())+" "+t(n.getHours())+":"+t(n.getMinutes())+":"+t(n.getSeconds())},cutTextRenderer:function(e){return function(t){return t=t||"",t.toString().length>e?t.toString().substring(0,e)+"...":t}},enumRenderer:function(e){return function(t){return e[t]||""}},multipleItemsRenderer:function(e){var t=n.enumRenderer(e);return function(e){var n=[];return e?(BUI.isArray(e)||(e=e.toString().split(",")),$.each(e,function(e,r){n.push(t(r))}),n.join(",")):""}},moneyCentRenderer:function(e){return BUI.isString(e)&&(e=parseFloat(e)),$.isNumberic(e)?(e*.01).toFixed(2):e}};return n}),function(){var e="bui/grid/plugins/";define("bui/grid/plugins",["bui/common",e+"selection",e+"cascade",e+"cellediting",e+"rowediting",e+"autofit",e+"dialogediting",e+"menu",e+"summary",e+"rownumber",e+"columngroup",e+"rowgroup",e+"columnresize"],function(t){var n=t("bui/common"),r=t(e+"selection"),i={};return n.mix(i,{CheckSelection:r.CheckSelection,RadioSelection:r.RadioSelection,Cascade:t(e+"cascade"),CellEditing:t(e+"cellediting"),RowEditing:t(e+"rowediting"),DialogEditing:t(e+"dialogediting"),AutoFit:t(e+"autofit"),GridMenu:t(e+"menu"),Summary:t(e+"summary"),RowNumber:t(e+"rownumber"),ColumnGroup:t(e+"columngroup"),RowGroup:t(e+"rowgroup"),ColumnResize:t(e+"columnresize")}),i})}(),define("bui/grid/plugins/autofit",["bui/common"],function(e){var t=e("bui/common"),n=t.UA,r=function(e){r.superclass.constructor.call(this,e)};return t.extend(r,t.Base),r.ATTRS={},t.augment(r,{bindUI:function(e){var t=this,n;$(window).on("resize",function(){function r(){clearTimeout(n),n=setTimeout(function(){t._autoFit(e)},100),t.set("handler",n)}r()})},_autoFit:function(e){var t=this,n=$(e.get("render")),r=$(window).width(),i,s=0,o=e.get("el").parent();while(o[0]&&o[0]!=$("body")[0])s+=o.outerWidth()-o.width(),o=o.parent();e.set("width",r-s)}}),r}),define("bui/grid/plugins/menu",["bui/common","bui/menu"],function(e){var t=e("bui/common"),n=e("bui/menu"),r=t.prefix,i="sort-asc",s="sort-desc",o="column-setting",u="icon-check",a=function(e){a.superclass.constructor.call(this,e)};return t.extend(a,t.Base),a.ATTRS={menu:{},activedColumn:{},triggerCls:{value:r+"grid-hd-menu-trigger"},items:{value:[{id:i,text:"\u5347\u5e8f",iconCls:"icon-arrow-up"},{id:s,text:"\u964d\u5e8f",iconCls:"icon-arrow-down"},{xclass:"menu-item-sparator"},{id:o,text:"\u8bbe\u7f6e\u5217",iconCls:"icon-list-alt"}]}},t.augment(a,{initializer:function(e){var t=this;t.set("grid",e)},renderUI:function(e){var n=this,r=e.get("columns");t.each(r,function(e){n._addShowMenu(e)})},bindUI:function(e){var t=this;e.on("columnadd",function(e){t._addShowMenu(e.column)}),e.on("columnclick",function(e){var n=$(e.domTarget),r=e.column,i;t.set("activedColumn",r),n.hasClass(t.get("triggerCls"))&&(i=t.get("menu")||t._initMenu(),i.set("align",{node:n,points:["bl","tl"],offset:[0,0]}),i.show(),t._afterShow(r,i))})},_addShowMenu:function(e){e.get("fixed")||e.set("showMenu",!0)},_afterShow:function(e,t){var n=this,r=n.get("grid");t=t||n.get("menu"),n._resetSortMenuItems(e,t),n._resetColumnsVisible(t)},_resetColumnsVisible:function(e){var t=this,n=e.findItemById(o),r=n.get("subMenu")||t._initColumnsMenu(n),i=t.get("grid").get("columns");r.removeChildren(!0),$.each(i,function(e,t){if(!t.get("fixed")){var n={xclass:"context-menu-item",text:t.get("title"),column:t,iconCls:"icon"},i=r.addChild(n);t.get("visible")&&i.set("selected",!0)}})},_resetSortMenuItems:function(e,t){var n=t.findItemById(i),r=t.findItemById(s);e.get("sortable")?(n.set("disabled",!1),r.set("disabled",!1)):(n.set("disabled",!0),r.set("disabled",!0))},_initMenu:function(){var e=this,t=e.get("menu"),r;return t||(r=e.get("items"),$.each(r,function(e,t){t.xclass||(t.xclass="context-menu-item")}),t=new n.ContextMenu({children:r,elCls:"grid-menu"}),e._initMenuEvent(t),e.set("menu",t)),t},_initMenuEvent:function(e){var t=this;e.on("itemclick",function(e){var n=e.item,r=n.get("id"),o=t.get("activedColumn");r===i?o.set("sortState","ASC"):r===s&&o.set("sortState","DESC")}),e.on("afterVisibleChange",function(e){var n=e.newVal,r=t.get("activedColumn");n&&r?r.set("open",!0):r.set("open",!1)})},_initColumnsMenu:function(e){var t=new n.ContextMenu({multipleSelect:!0,elCls:"grid-column-menu"});return e.set("subMenu",t),t.on("itemclick",function(e){var t=e.item,n=t.get("column"),r=t.get("selected");r?n.set("visible",!0):n.set("visible",!1)}),t},destructor:function(){var e=this,t=e.get("menu");t&&t.destroy(),e.off(),e.clearAttrVals()}}),a}),define("bui/grid/plugins/cascade",["bui/common"],function(e){var t=e("bui/common"),n=t.prefix,r="",i="data-record",s=n+"grid-cascade",o=s+"-expand",u=s+"-row",a=s+"-cell",f=s+"-collapse",l=function(e){l.superclass.constructor.call(this,e)};return t.extend(l,t.Base),l.ATTRS={width:{value:40},cellInner:{value:'<span class="'+s+'"><i class="'+s+'-icon"></i></span>'},rowTpl:{value:'<tr class="'+u+'"><td class="'+a+'"></td></tr>'},renderer:{},events:["expand","collapse","removed"]},t.augment(l,{initializer:function(e){var t=this,n={title:"",elCls:"center",width:t.get("width"),resizable:!1,fixed:!0,sortable:!1,cellTpl:t.get("cellInner")},r=e.addColumn(n,0);e.set("innerBorder",!1),t.set("grid",e)},bindUI:function(e){var t=this;e.on("cellclick",function(e){var n=$(e.domTarget),r=n.closest("."+s);r.length&&(r.hasClass(o)?t._onCollapse(e.record,e.row,r):t._onExpand(e.record,e.row,r))}),e.on("columnvisiblechange",function(){t._resetColspan()}),e.on("rowremoved",function(e){t.remove(e.record)}),e.on("clear",function(){t.removeAll()})},expandAll:function(){var e=this,t=e.get("grid"),n=t.getRecords();$.each(n,function(t,n){e.expand(n)})},expand:function(e){var t=this,n=t.get("grid"),r=n.findRow(e);r&&t._onExpand(e,r)},collapse:function(e){var t=this,n=t.get("grid"),r=n.findRow(e);r&&t._onCollapse(e,r)},removeAll:function(){var e=this,t=e._getAllCascadeRows();t.each(function(t,n){e._removeCascadeRow(n)})},remove:function(e){var t=this,n=t._findCascadeRow(e);n&&t._removeCascadeRow(n)},collapseAll:function(){var e=this,t=e.get("grid"),n=t.getRecords();$.each(n,function(t,n){e.collapse(n)})},_getRowRecord:function(e){return $(e).data(i)},_removeCascadeRow:function(e){this.fire("removed",{record:$(e).data(i),row:e}),$(e).remove()},_findCascadeRow:function(e){var t=this,n=t._getAllCascadeRows(),r=null;return $.each(n,function(n,i){if(t._getRowRecord(i)===e)return r=i,!1}),r},_getAllCascadeRows:function(){var e=this,t=e.get("grid");return t.get("el").find("."+u)},_getCascadeRow:function(e){var t=$(e).next();return t.hasClass(u)?t:null},_getRowContent:function(e){var t=this,n=t.get("renderer"),r=n?n(e):"";return r},_createCascadeRow:function(e,t){var n=this,r=n.get("rowTpl"),s=n._getRowContent(e),o=$(r).insertAfter(t);return o.find("."+a).append($(s)),o.data(i,e),o},_onExpand:function(e,t,n){var r=this,i=r._getCascadeRow(t),u=r._getColumnCount(t);n=n||$(t).find("."+s),n.addClass(o);if(!i||!i.length)i=r._createCascadeRow(e,t);$(i).removeClass(f),r._setColSpan(i,t),r.fire("expand",{record:e,row:i[0]})},_onCollapse:function(e,t,n){var r=this,i=r._getCascadeRow(t);n=n||$(t).find("."+s),n.removeClass(o);if(i||!i.length)$(i).addClass(f),r.fire("collapse",{record:e,row:i[0]})},_getColumnCount:function(e){return $(e).children().filter(function(){return $(this).css("display")!=="none"}).length},_setColSpan:function(e,t){t=t||$(e).prev();var n=this,r=n._getColumnCount(t);$(e).find("."+a).attr("colspan",r)},_resetColspan:function(){var e=this,t=e._getAllCascadeRows();$.each(t,function(t,n){e._setColSpan(n)})},destructor:function(){var e=this;e.removeAll(),e.off(),e.clearAttrVals()}}),l}),define("bui/grid/plugins/selection",["bui/common"],function(e){function o(e){o.superclass.constructor.call(this,e)}var t=e("bui/common"),n=t.prefix,r=n+"grid-checkBox",i="x-grid-checkbox",s=n+"grid-radio";t.extend(o,t.Base),o.ATTRS={width:{value:40},column:{},cellInner:{value:'<div class="'+r+'-container"><span class="'+i+'"></span></div>'}},t.augment(o,{createDom:function(e){var t=this,r={title:"",width:t.get("width"),fixed:!0,resizable:!1,sortable:!1,tpl:'<div class="'+n+'grid-hd-inner">'+t.get("cellInner")+"",cellTpl:t.get("cellInner")},i=e.addColumn(r,0);e.set("multipleSelect",!0),t.set("column",i)},bindUI:function(e){var t=this,n=t.get("column"),r=n.get("el"),s=r.find("."+i);s.on("click",function(){var t=r.hasClass("checked");t?(e.clearSelection(),r.removeClass("checked")):(e.setAllSelection(),r.addClass("checked"))}),e.on("rowunselected",function(e){r.removeClass("checked")}),e.on("clear",function(){r.removeClass("checked")})}});var u=function(e){u.superclass.constructor.call(this,e)};t.extend(u,t.Base),u.ATTRS={width:{value:40},column:{},cellInner:{value:'<div class="'+n+'grid-radio-container"><input  class="'+s+'" type="radio"></div>'}},t.augment(u,{createDom:function(e){var t=this,n={title:"",width:t.get("width"),resizable:!1,fixed:!0,sortable:!1,cellTpl:t.get("cellInner")},r=e.addColumn(n,0);e.set("multipleSelect",!1),t.set("column",r)},bindUI:function(e){var t=this;e.on("rowselected",function(e){t._setRowChecked(e.row,!0)}),e.on("rowunselected",function(e){t._setRowChecked(e.row,!1)})},_setRowChecked:function(e,t){var n=$(e),r=n.find("."+s);r.attr("checked",t)}});var a={CheckSelection:o,RadioSelection:u};return a}),define("bui/grid/plugins/summary",["bui/common"],function(e){function l(e){return e>0?'<td class="'+f+'" colspan="'+e+'">&nbsp;</td>':""}function c(e,t){return'<td class="'+f+" "+u+t+'">'+h(e)+"</td>"}function h(e){return'<div class="'+o+'" >'+'<span class="'+a+' ">'+e+"</span>"+"</div>"}function p(){return'<td class="'+f+" "+f+'-empty">&nbsp;</td>'}var t=e("bui/common"),n=t.prefix,r=n+"grid-row",i=n+"grid-body",s=n+"grid-summary-row",o=n+"grid-cell-inner",u="grid-td-",a=n+"grid-cell-text",f=n+"grid-cell",d=function(e){d.superclass.constructor.call(this,e)};return d.ATTRS={footerTpl:{value:"<tfoot></tfoot>"},footerEl:{},summaryTitle:{value:"\u67e5\u8be2\u5408\u8ba1"},pageSummaryTitle:{value:"\u672c\u9875\u5408\u8ba1"},field:{value:"summary"},pageSummaryField:{value:"pageSummary"},summaryField:{value:"summary"},pageSummary:{},summary:{}},t.extend(d,t.Base),t.augment(d,{initializer:function(e){var t=this;t.set("grid",e)},renderUI:function(e){var t=this,n=e.get("el").find("."+i),r=n.find("table"),s=$(t.get("footerTpl")).appendTo(r);t.set("footerEl",s)},bindUI:function(e){var t=this,n=e.get("store");n&&(n.on("beforeprocessload",function(e){t._processSummary(e.data)}),n.on("add",function(){t.resetPageSummary()}),n.on("remove",function(){t.resetPageSummary()}),n.on("update",function(){t.resetPageSummary()})),e.on("aftershow",function(){t.resetSummary()}),e.get("header").on("afterVisibleChange",function(){t.resetSummary()})},_processSummary:function(e){var t=this,n=t.get("footerEl");n.empty();if(!e)return;var r=e[t.get("pageSummaryField")],i=e[t.get("summaryField")];t.set("pageSummary",r),t.set("summary",i)},resetPageSummary:function(){var e=this,n=e.get("grid"),r=n.get("columns"),i=e._calculatePageSummary(),s=e.get("pageEl");e.set("pageSummary",i),s&&(t.each(r,function(t){if(t.get("summary")&&t.get("visible")){var n=t.get("id"
),r=s.find("."+u+n),o=e._getSummaryCellText(t,i);r.find("."+a).text(o)}}),e._updateFirstRow(s,e.get("pageSummaryTitle")))},resetSummary:function(e,t){var n=this,r=n.get("footerEl"),i=null;r.empty(),e=e||n.get("pageSummary"),e||(e=n._calculatePageSummary(),n.set("pageSummary",e)),t=t||n.get("summary"),i=n._creatSummaryRow(e,n.get("pageSummaryTitle")),n.set("pageEl",i),n._creatSummaryRow(t,n.get("summaryTitle"))},_creatSummaryRow:function(e,t){if(!e)return null;var n=this,r=n.get("footerEl"),i=n._getSummaryTpl(e),s=$(i).appendTo(r);return n._updateFirstRow(s,t),s},_updateFirstRow:function(e,t){var n=e.find("td").first(),r=n.find("."+o);if(r.length){var i=t+": ";text=r.text(),text.indexOf(i)===-1&&(text=i+text),n.html(h(text))}else n.html(h(t+":"))},_getSummaryTpl:function(e){var t=this,n=t.get("grid"),i=n.get("columns"),o=[],u=-1,a=-1,f=null;return $.each(i,function(n,r){if(r.get("visible")){a+=1;if(r.get("summary")){o.push(l(a-u-1));var i=t._getSummaryCellText(r,e),s=c(i,r.get("id"));o.push(s),u=a}}}),u!==a&&o.push(l(a-u)),f=['<tr class="',s," ",r,'">',o.join(""),p(),"</tr>"].join(""),f},_getSummaryCellText:function(e,t){var n=this,r=t[e.get("dataIndex")],i=r==null?"":r,s=e.get("renderer"),o=s?s(i,t):i;return o},_calculatePageSummary:function(){var e=this,n=e.get("grid"),r=n.get("store"),i=n.get("columns"),s={};return t.each(i,function(e){if(e.get("summary")){var t=e.get("dataIndex");s[t]=r.sum(t)}}),s}}),d}),define("bui/grid/plugins/editing",function(e){function r(e){r.superclass.constructor.call(this,e)}var t=BUI.prefix+"grid-cell-inner",n=BUI.prefix+"grid-cell-error";return BUI.extend(r,BUI.Base),r.ATTRS={align:{value:{points:["cl","cl"]}},showError:{value:!0},errorTpl:{value:'<span class="x-icon '+n+' x-icon-mini x-icon-error" title="{error}">!</span>'},isInitEditors:{value:!1},record:{},curEditor:{},hasValid:{},editors:{shared:!1,value:[]},triggerCls:{},triggerSelected:{value:!0}},BUI.augment(r,{initializer:function(e){var t=this;t.set("grid",e),t.initEditing(e)},renderUI:function(){var e=this,t=e.get("grid");BUI.use("bui/editor",function(n){e.initEditors(n),e._initGridEvent(t),e.set("isInitEditors",!0),e.fire("editorready")})},initEditing:function(e){},_getCurEditor:function(){return this.get("curEditor")},_initGridEvent:function(e){function r(e,n){t.get("hasValid")&&t.validRecord(e,t.getFields(),$(n))}var t=this,n=e.get("header");e.on("cellclick",function(e){var n=null,r=e.domTarget,i=t.get("triggerCls"),s=t._getCurEditor();s&&s.get("acceptEvent")?(s.accept(),s.hide()):s&&s.cancel(),n=t.getEditor(e.field);if(n&&$(r).closest("."+i).length){t.showEditor(n,e);if(!t.get("triggerSelected"))return!1}}),e.on("rowcreated",function(e){r(e.record,e.row)}),e.on("rowremoved",function(e){t.get("record")==e.record&&t.cancel()}),e.on("rowupdated",function(e){r(e.record,e.row)}),e.on("scroll",function(e){var n=t._getCurEditor();if(n){var r=n.get("align"),i=r.node,s=i.position();s.top<0||s.top>e.bodyHeight?n.hide():(n.set("align",r),n.show())}}),n.on("afterVisibleChange",function(e){if(e.target&&e.target!=n){var r=e.target;t.onColumnVisibleChange(r)}})},initEditors:function(e){var t=this,n=t.get("grid"),r=[],i=n.get("columns");BUI.each(i,function(e){var n=t.getFieldConfig(e);n&&(n.name=e.get("dataIndex"),n.validator&&(n.validator=t.wrapValidator(n.validator)),r.push(n))});var s=t.getEditorCfgs(r);BUI.each(s,function(n){t.initEidtor(n,e)})},getFieldConfig:function(e){return e.get("editor")},wrapValidator:function(e){var t=this;return function(n){var r=t.get("record");return e(n,r)}},onColumnVisibleChange:function(e){},getEditorCfgs:function(e){},getEditorConstructor:function(e){return e.Editor},initEidtor:function(e,t){var n=this,r=n.getEditorConstructor(t),i=new r(e);return i.render(),n.get("editors").push(i),n.bindEidtor(i),i},bindEidtor:function(e){var t=this,n=t.get("grid"),r=n.get("store");e.on("accept",function(){var n=t.get("record");t.updateRecord(r,n,e),t.fire("accept",{editor:e,record:n}),t.set("curEditor",null)}),e.on("cancel",function(){t.fire("cancel",{editor:e,record:t.get("record")}),t.set("curEditor",null)})},getEditor:function(e){},getAlignNode:function(e){},getEditValue:function(e){},showEditor:function(e,t){var n=this,r=n.getEditValue(t),i=n.getAlignNode(t);n.beforeShowEditor(e,t),n.set("record",t.record),n.fire("beforeeditorshow",{editor:e,record:t.record}),e.setValue(r);if(i){var s=n.get("align");s.node=i,e.set("align",s)}e.show(),n.focusEditor(e,t.field),n.set("curEditor",e),n.fire("editorshow",{editor:e,record:t.record})},focusEditor:function(e,t){e.focus()},beforeShowEditor:function(e,t){},_createEditOptions:function(e,t){var n=this,r=n.get("grid"),i=r.findRow(e),s=r.findColumnByField(t),o=r.findCell(s.get("id"),i);return{record:e,field:t,cell:o[0],row:i[0]}},valid:function(){var e=this,t=e.get("grid"),n=t.get("store");if(n){var r=n.getResult();BUI.each(r,function(t){e.validRecord(t,e.getFields())})}e.set("hasValid",!0)},isValid:function(){var e=this,t=e.get("grid");return e.get("hasValid")||e.valid(),!t.get("el").find("."+n).length},clearErrors:function(){var e=this,t=e.get("grid");t.get("el").find("."+n).remove()},getFields:function(e){},validRecord:function(e,t,n){var r=this,i=[];r.setInternal("record",e),t=t||r.getFields(),BUI.each(t,function(t){var n=t.get("name"),r=e[n]||"",s=t.getValidError(r);s&&i.push({name:n,error:s,id:t.get("id")})}),r.showRecordError(e,i,n)},showRecordError:function(e,t,n){var r=this,i=r.get("grid");n=n||i.findRow(e),n&&(r._clearRowError(n),BUI.each(t,function(e){var t=i.findCell(e.id,n);r._showCellError(t,e.error)}))},updateRecord:function(e,t,n){},_clearRowError:function(e){e.find("."+n).remove()},_showCellError:function(e,n){var r=this,i=BUI.substitute(r.get("errorTpl"),{error:n}),s=e.find("."+t);$(i).appendTo(s)},edit:function(e,t){var n=this,r=n._createEditOptions(e,t),i=n.getEditor(t);n.showEditor(i,r)},cancel:function(){var e=this,t=e.get("editors");BUI.each(t,function(e){e.get("visible")&&e.cancel()}),e.set("curEditor",null),e.set("record",null)},destructor:function(){var e=this,t=e.get("editors");BUI.each(t,function(e){e.destroy&&e.destroy()}),e.off(),e.clearAttrVals()}}),r}),define("bui/grid/plugins/cellediting",["bui/grid/plugins/editing"],function(e){var t=e("bui/grid/plugins/editing"),n=BUI.prefix+"grid-body",r=BUI.prefix+"grid-cell",i=function(e){i.superclass.constructor.call(this,e)};return i.ATTRS={triggerCls:{value:r}},BUI.extend(i,t),BUI.augment(i,{getEditorCfgs:function(e){var t=this,r=t.get("grid"),i=r.get("el").find("."+n),s=[];return BUI.each(e,function(e){var t={field:e,changeSourceEvent:null,hideExceptNode:i,autoUpdate:!1,preventHide:!1,editableFn:e.editableFn};e.xtype==="checkbox"&&(t.innerValueField="checked"),s.push(t)}),s},getEditor:function(e){if(!e)return null;var t=this,n=t.get("editors"),r=null;return BUI.each(n,function(t){if(t.get("field").get("name")===e)return r=t,!1}),r},beforeShowEditor:function(e,t){var n=this,r=$(t.cell);n.resetWidth(e,r.outerWidth()),n._makeEnable(e,t)},_makeEnable:function(e,t){var n=e.get("editableFn"),r,i,s;BUI.isFunction(n)&&(r=t.field,s=t.record,s&&r&&(i=n(s[r],s),i?e.get("field").enable():e.get("field").disable()))},resetWidth:function(e,t){e.set("width",t)},updateRecord:function(e,t,n){var r=this,i=n.getValue(),s=n.get("field").get("name"),o=t[s];i=BUI.isDate(i)?i.getTime():i,o!==i&&e.setValue(t,s,i)},getAlignNode:function(e){return $(e.cell)},getFields:function(){var e=[],t=this,n=t.get("editors");return BUI.each(n,function(t){e.push(t.get("field"))}),e},getEditValue:function(e){if(e.record&&e.field){var t=e.record[e.field];return t==null?"":t}return""}}),i}),define("bui/grid/plugins/rowediting",["bui/common","bui/grid/plugins/editing"],function(e){var t=e("bui/common"),n=e("bui/grid/plugins/editing"),r=t.prefix+"grid-row",i=function(e){i.superclass.constructor.call(this,e)};return i.ATTRS={autoSave:{value:!1},align:{value:{points:["tl","tl"],offset:[-2,0]}},triggerCls:{value:r},editor:{}},t.extend(i,n),t.augment(i,{getEditorCfgs:function(e){var n=this,r=n.get("editor"),i=[],s=t.mix(!0,{changeSourceEvent:null,autoUpdate:!1,form:{children:e,buttonBar:{elCls:"centered toolbar"}}},r);return i.push(s),i},wrapValidator:function(e){var t=this;return function(n){var r=t.get("curEditor"),i=t.get("record"),s=r?r.getValue():i;if(s)return e(n,s,i)}},focusEditor:function(e,t){var n=e.get("form"),r=n.getField(t);r&&r.focus()},getFieldConfig:function(e){var t=e.get("editor");if(t)return t.xtype==="checkbox"&&(t.innerValueField="checked"),t;var n={xtype:"plain"};return e.get("dataIndex")&&e.get("renderer")&&(n.renderer=e.get("renderer")),n},updateRecord:function(e,n,r){var i=this,s=r.getValue();t.each(s,function(e,n){t.isDate(e)&&(s[n]=e.getTime())}),t.mix(n,s),e.update(n),i.get("autoSave")&&e.save(n)},getEditor:function(e){var t=this,n=t.get("editors");return n[0]},onColumnVisibleChange:function(e){var t=this,n=e.get("id"),r=t.getEditor(),i=r.getChild(n,!0);i&&i.set("visible",e.get("visible"))},beforeShowEditor:function(e,n){var r=this,i=r.get("grid"),s=i.get("columns"),o=e.get("form"),u=$(n.row);e.set("width",u.width()),t.each(s,function(e){var t=e.get("dataIndex"),n=o.getField(t);if(!e.get("visible"))n&&n.set("visible",!1);else{var r=e.get("el").outerWidth()-n.getAppendWidth();n.set("width",r)}})},getEditValue:function(e){return e.record},getEditorConstructor:function(e){return e.RecordEditor},getAlignNode:function(e){return $(e.row)},getFields:function(){var e=this,t=e.get("editors");return t[0].get("form").get("children")}}),i}),define("bui/grid/plugins/dialogediting",["bui/common"],function(e){function i(e){i.superclass.constructor.call(this,e)}var t=e("bui/common"),n="add",r="edit";return i.ATTRS={autoSave:{value:!1},record:{},curIndex:{},contentId:{},editor:{},form:{},events:{value:{recordchange:!1}},editType:{}},t.extend(i,t.Base),t.augment(i,{initializer:function(e){var n=this;n.set("grid",e),t.use("bui/editor",function(e){n._initEditor(e),n.fire("editorready")})},bindUI:function(e){var t=this,n=t.get("triggerCls");n&&e.on("cellclick",function(r){var i=$(r.domTarget),s=t.get("editor");if(i.hasClass(n)&&s){t.edit(r.record);if(e.get("multipleSelect"))return!1}})},_initEditor:function(e){var n=this,r=n.get("contentId"),i=$("#"+r).find("form"),s=n.get("editor"),o=t.merge(s,{contentId:r,form:{srcNode:i}});s=new e.DialogEditor(o),n._bindEditor(s),n.set("editor",s),n.set("form",s.get("form"))},_bindEditor:function(e){var t=this;e.on("accept",function(){var n=e.get("form"),r=n.serializeToObject();t.saveRecord(r),t.fire("accept",{editor:e,record:t.get("record"),form:n})}),e.on("cancel",function(){t.fire("cancel",{editor:e,record:t.get("record"),form:e.get("form")})})},edit:function(e){var t=this;t.set("editType",r),t.showEditor(e)},add:function(e,t){var r=this;r.set("editType",n),r.set("curIndex",t),r.showEditor(e)},saveRecord:function(e){var r=this,i=r.get("grid"),s=r.get("editType"),o=r.get("curIndex"),u=i.get("store"),a=r.get("record");t.mix(a,e),s==n?o!=null?u.addAt(a,o):u.add(a):u.update(a),r.get("autoSave")&&u.save(a)},showEditor:function(e){var t=this,n=t.get("editor");t.set("record",e),n.show(),n.setValue(e,!0),t.fire("recordchange",{record:e,editType:t.get("editType")}),t.fire("editorshow",{eidtor:n,editType:t.get("editType")})},cancel:function(){var e=this,t=e.get("editor");t.cancel()},destructor:function(){var e=this,t=e.get("editor");t&&t.destroy(),e.off(),e.clearAttrVals()}}),i}),define("bui/grid/plugins/rownumber",function(e){function n(e){n.superclass.constructor.call(this,e)}var t="x-grid-rownumber";return BUI.extend(n,BUI.Base),n.ATTRS={width:{value:40},column:{}},BUI.augment(n,{createDom:function(e){var n=this,r={title:"",width:n.get("width"),fixed:!0,resizable:!1,sortable:!1,renderer:function(e,t,n){return n+1},elCls:t},i=e.addColumn(r,0);n.set("column",i)}}),n}),define("bui/grid/plugins/columngroup",["bui/common"],function(e){var t=e("bui/common"),n=t.prefix,r=n+"grid-hd-title",i=n+"grid-column-group",s=n+"grid-group-header",o=n+"grid-db-hd",u=function(e){u.superclass.constructor.call(this,e)};return u.ATTRS={groups:{value:[]},columnTpl:{value:'<th class="bui-grid-hd center" colspan="{colspan}"><div class="'+n+'grid-hd-inner">'+'<span class="'+r+'">{title}</span>'+"</div></th>"}},t.extend(u,t.Base),t.augment(u,{renderUI:function(e){var n=this,r=n.get("groups"),u=e.get("header"),a=u.get("el"),f=u.get("children"),l=$('<tr class="'+i+'"></tr>').prependTo(a.find("thead"));a.addClass(s),t.each(r,function(e){var t=n._getGroupTpl(e),r=$(t).appendTo(l);e.el=r;for(var i=e.from;i<=e.to;i++){var s=f[i];s&&s.set("group",e)}});var c;for(var h=f.length-1;h>=0;h--){var p=f[h],d=p.get("group");if(d)c=d.el;else{var v=p.get("el");v.addClass(o),v.attr("rowspan",2),c?v.insertBefore(c):v.appendTo(l),c=v}}if(r[0].from!==0){var m=f[r[0].from];m&&m.get("el").css("border-left-width",1)}},_getGroupTpl:function(e){var n=this,r=n.get("columnTpl"),i=e.to-e.from+1;return t.substitute(r,{colspan:i,title:e.title})}}),u}),define("bui/grid/plugins/rowgroup",["bui/common"],function(e){function u(e,t){return{items:[],value:e,text:t}}var t=e("bui/common"),n="data-group",r=t.prefix,i=r+"grid-row-group",s=r+"grid-cascade",o=r+"grid-cascade-expand",a=function(e){a.superclass.constructor.call(this,e)};return a.ATTRS={groups:{shared:!1,value:[]},renderer:{}},t.extend(a,t.Base),t.augment(a,{renderUI:function(e){var t=this,n=e.get("el").find("tbody");t.set("grid",e),t.set("tbodyEl",n)},bindUI:function(e){var n=this,r=[];e.on("aftershow",function(){var i=e.getItems(),s=n._getSortColumn();n._clear();if(s){e.get("view").getAllElements().hide();var o=s.get("dataIndex");t.each(i,function(e,t){var i=r[r.length-1],a=s.get("renderer"),f=e[o],l;if(!i||f!=i.value){l=a?a(f,e):f;var c=u(f,l);c.begin=t,r.push(c),i&&n._createGroup(i),i=c}i.items.push(e)});var a=r[r.length-1];a&&n._createGroup(a),n.set("groups",r)}}),e.on("clear",function(){n._clear()}),n.get("tbodyEl").delegate("."+s,"click",function(e){var t=$(e.currentTarget),r=n._getGroupData(t);t.hasClass(o)?(n._collapse(r),t.removeClass(o)):(n._expand(r),t.addClass(o))})},_getSortColumn:function(){var e=this,t=e.get("grid"),n=t.get("store"),r=n.get("sortField");return t.findColumnByField(r)},_getGroupData:function(e){var t=this,r=e.closest("."+i);return r.data(n)},_createGroup:function(e){var t=this,r=t.get("grid"),s=e.items[0],o=r.findElement(s),u=r.get("columns").length,a=t.get("renderer"),f=a?a(e.text,e):e.text,l='<tr class="'+i+'"><td colspan="'+(u+1)+'"><div class="bui-grid-cell-inner"><span class="bui-grid-cell-text"><span class="bui-grid-cascade"><i class="bui-grid-cascade-icon"></i></span> '+f+"</span></div></td></tr>",c=$(l).insertBefore(o);c.data(n,e)},_getGroupedElements:function(e){var t=this,n=t.get("grid"),r=n.get("view").getAllElements(),i=e.begin,s=e.items.length+i,o=[];for(var u=i;u<s;u++)o.push(r[u]);return $(o)},_expand:function(e){var t=this,n=t._getGroupedElements(e);n.show()},_collapse:function(e){var t=this,n=t._getGroupedElements(e);n.hide()},_clear:function(){var e=this,n=e.get("groups"),r=e.get("tbodyEl");t.Array.empty(n),r.find("."+i).remove()}}),a}),define("bui/grid/plugins/columnresize",function(e){var t=e("bui/common"),n=15,r=30,i="col-resize",s=function(e){s.superclass.constructor.call(this,e)};return s.ATTRS={resizing:{value:!1},draging:{}},t.extend(s,t.Base),t.augment(s,{renderUI:function(e){this.set("grid",e)},bindUI:function(e){function f(n){var r=t.get("draging");if(o&&r){var i=a>0?o:u,s=i.get("width"),l=r.end-r.start;t.hideDrag();if(e.get("forceFit")){var c=i.get("originWidth"),h=s/c,p=(s+l)/h;i.set("originWidth",p),i.set("width",p)}else i.set("width",s+l)}$(document).off("mouseup",f)}function l(){$(document).on("mouseup",f)}var t=this,s=e.get("header"),o,u,a;s.get("el").delegate(".bui-grid-hd","mouseenter",function(e){var n=t.get("resizing");if(!n){var r=e.currentTarget;o=t._getColumn(r),u=t._getPreCol(o)}}).delegate(".bui-grid-hd","mouseleave",function(e){var n=t.get("resizing");!n&&o&&(o.get("el").css("cursor",""),o=null)}).delegate(".bui-grid-hd","mousemove",function(s){var f=t.get("resizing");if(!f&&o){var l=o.get("el"),c=s.pageX,h=l.offset(),p=h.left,d=l.width();c-p<n&&u?(l.css("cursor",i),a=-1):p+d-c<n?(a=1,l.css("cursor",i)):o.get("el").css("cursor","")}if(f){s.preventDefault();var v=t.get("draging"),m=v.start,c=s.pageX,g=c-m,d=a>0?o.get("width"):u.get("width"),y=d+g;y>r&&y<e.get("el").width()&&(v.end=c,t.moveDrag(c))}}).delegate(".bui-grid-hd","mousedown",function(e){var n=t.get("resizing");!n&&o&&o.get("el").css("cursor")==i&&(e.preventDefault(),t.showDrag(e.pageX),l())})},showDrag:function(e){var t=this,n=t.get("grid"),r=n.get("header"),i=n.get("el").find(".bui-grid-body"),s=r.get("el").height()+i.height(),o=r.get("el").offset(),u=t.get("dragEl");if(!u){var a='<div class="bui-drag-line"></div>';u=$(a).appendTo("body"),t.set("dragEl",u)}u.css({top:o.top,left:e,height:s}),t.set("resizing",!0),t.set("draging",{start:e,end:e}),u.show()},hideDrag:function(){var e=this,t=e.get("dragEl");t&&t.hide(),e.set("draging",null),e.set("resizing",!1)},moveDrag:function(e){var t=this,n=t.get("dragEl");n&&n.css("left",e)},_getColumn:function(e){var n=this,r=n.get("grid").get("columns"),i=null;return t.each(r,function(t){if(t.containsElement(e))return i=t,!1}),i},_getPreCol:function(e){var n=this,r=n.get("grid").get("columns"),i=null;return t.each(r,function(t,n){if(t==e)return!1;t.get("visible")&&(i=t)}),i}}),s});
