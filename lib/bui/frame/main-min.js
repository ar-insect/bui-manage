define("frame/main",["bui/menu","bui/tab"],function(a){function b(a){window.topManager=a}function c(a,b){return-1!==a.indexOf("?")?a+"&"+b:a+"?"+b}function d(a,b,c,d,f){var g=this,h=new m.SideMenu(c),i=new n.NavTab(b),j=$(c.render),k=j.next("."+t+"-con"),l=j.parents("."+u);k&&(k.on("click",function(){l.toggleClass(v)}),k.parent().height(b.height)),d&&l.addClass(v),h.on("menuclick",function(a){var b=a.item;b&&g.tab.addTab({id:b.get("id"),title:b.get("text"),href:b.get("href"),closeable:b.get("closeable")},!0)}),h.on("itemselected",function(b){var c=b.item;c&&e(a,c.get("id"))}),i.on("activeChange",function(a){var b=a.item;b?g.menu.setSelectedByField(b.get("id")):g.menu.clearSelection()}),g.tab=i,g.menu=h,g.homePage=f,i.render(),h.render()}function e(a,b){b=b||"";var c="#"+a;b&&(c+="/"+b),location.hash=c}function f(){var a=location.hash,b=0,c="",d=a.indexOf("/"),e=null;return a?(d>=0?(b=a.substring(1,d),c=a.substring(d+1),e=g(c),e&&(c=c.replace("?"+e,""))):b=a.substring(1),{moduleId:b,pageId:c,search:e}):null}function g(a){var b=a.indexOf("?");return b>=0?a.substring(b+1):null}function h(a){if($.isArray(a)){for(var b=i(a);-1!==b;)a.splice(b,1),b=i(a);return a}}function i(a){var b=-1;return $.each(a,function(a,c){return null===c||void 0===c?(b=a,!1):void 0}),b}function j(){var a=BUI.viewportHeight(),b=70;return a-b}function k(a){var b=$(a);return b.hasClass(s)?a:b.parent("."+s)[0]}var l=BUI.app("PageUtil"),m=a("bui/menu"),n=a("bui/tab"),o="dl-selected",p="ks-hidden",q="dl-last",r="dl-hover",s="nav-item",t="dl-second-slib",u="dl-tab-item",v="dl-collapse",w="dl-hide-current",x="data-index",y=145,z=function(a){h(a),z.superclass.constructor.call(this,a),this._init(),b(this)};return z.ATTRS={currentModelIndex:{},hideItmes:{value:[]},hideList:{},modules:{value:[]},modulesConfig:{},navList:{valueFn:function(){return $("#J_Nav")}},navContent:{valueFn:function(){return $("#J_NavContent")}},navItems:{valueFn:function(){return $("#J_Nav").children("."+s)}},navTabs:{valueFn:function(){return this.get("navContent").children("."+u)}},urlSuffix:{value:".html"}},BUI.extend(z,BUI.Base),BUI.augment(z,{openPage:function(a){var b=this,c=a.moduleId||b._getCurrentModuleId(),d=a.id,e=a.title||"新的标签页",f=a.href,g=a.isClose,h=a.closeable,i=a.reload,j=a.search,k=b._getModule(c);if(k){var l=k.tab,m=k.menu,n=m.getItem(d),o=l.getActivedItem(),p=o?o.get("id"):null,q=b._getModuleIndex(c);c!=b._getCurrentModuleId()&&b._setModuleSelected(q),n?b._setPageSelected(q,d,i,j):l.addTab({id:d,title:e,href:f,sourceId:p,closeable:h},i),g&&o.close()}},closePage:function(a,b){this.operatePage(b,a,"close")},reloadPage:function(a,b){this.operatePage(b,a,"reload")},setPageTitle:function(a,b,c){this.operatePage(c,b,"setTitle",[a])},operatePage:function(a,b,c,d){a=a||this._getCurrentModuleId(),d=d||[];var e=this,f=e._getModule(a);if(f){var g=f.tab,h=b?g.getItemById(b):g.getActivedItem();h&&h[c]&&h[c].apply(h,d)}},_createModule:function(a){var b=this,c=b._getModuleConfig(a),e=b.get("modules");if(!c)return null;var a=c.id,f="#J_"+a+"Tab",g="#J_"+a+"Tree";return module=new d(a,{render:f,height:j()-5},{render:g,items:c.menu,height:j()-5},c.collapsed,c.homePage),e[a]=module,module},_hideHideList:function(){this.get("hideList").hide()},_init:function(){var a=this;a._initDom(),a._initNavItems(),a._initEvent()},_initNavItems:function(){var a=this,b=a.get("navItems"),c=a.get("hideItmes");if(0!==b.length){$('<div class="nav-item-mask"></div>').appendTo($(b));var d=b.length,e=BUI.viewportWidth(),f=y,g=f*d,h=0;if(!(e>=g)){$.each(b,function(a,b){$(b).attr(x,a),$(b).removeClass(q)}),h=parseInt(e/f);var i=b[h-1];a._setLastItem(i),c.push($(i).clone()[0]);for(var j=h;d>j;j++){var k=$(b[j]),l=null;l=k.clone()[0],c.push(l),k.addClass(p)}a._initHideList()}}},_initHideList:function(){var a=this,b=a.get("hideList"),c=a.get("hideItmes");if(!b){var d='<ul class="dl-hide-list ks-hidden"></ul>',e=$(d).appendTo("body");b=e,$.each(c,function(a,c){$(c).appendTo(b)}),a.set("hideList",b),a._initHideListEvent()}},_initHideListEvent:function(){var a=this,b=a.get("hideList");null!=b&&(b.on("mouseleave",function(){a._hideHideList()}),b.on("click",function(b){var c=k(b.target),d=null,e=0;c&&(d=$(c),e=d.attr(x),a._setModuleSelected(e),a._hideHideList())}))},_initContents:function(){var a=this,b=a.get("modulesConfig"),c=a.get("navContent");c.children().remove(),$.each(b,function(a,b){var d=b.id,e=['<li class="dl-tab-item ks-hidden"><div class="dl-second-nav"><div class="dl-second-tree" id="J_',d,'Tree"></div><div class="',t,'-con"><div class="',t,'"></div></div></div><div class="dl-inner-tab" id="J_',d,'Tab"></div></li>'].join("");new $(e).appendTo(c)})},_initDom:function(){var a=this;a._initContents(),a._initLocation()},_initEvent:function(){var a=this,b=a.get("navItems");b.each(function(b,c){var c=$(c);c.on("click",function(){var c=$(this);c.hasClass(o)||a._setModuleSelected(b,c)}).on("mouseenter",function(){$(this).addClass(r)}).on("mouseleave",function(){$(this).removeClass(r)})}),a._initNavListEvent()},_initNavListEvent:function(){var a=this,b=a.get("hideList"),c=a.get("navList");c.on("mouseover",function(c){var d=k(c.target),e=$(d),f=null;e&&e.hasClass(q)&&b&&(f=e.offset(),f.top+=37,f.left+=2,a._showHideList(f))}).on("mouseout",function(c){var d=c.toElement;d&&b&&!$.contains(b[0],d)&&d!==b[0]&&a._hideHideList()})},_initLocation:function(){var a=this,b=f();if(b){var c=b.pageId,d=b.search,g=a._getModuleIndex(b.moduleId);a._setModuleSelected(g),a._setPageSelected(g,c,!0,d)}else{var h=a.get("currentModelIndex"),i=a._getModuleId(h);null==h?a._setModuleSelected(0):e(i)}},_getModule:function(a){var b=this,c=b.get("modules")[a];return c||(c=b._createModule(a)),c},_getModuleIndex:function(a){var b=this,c=0;return $.each(b.get("modulesConfig"),function(b,d){return d.id===a?(c=b,!1):void 0}),c},_getModuleConfig:function(a){var b=this,c=null;return $.each(b.get("modulesConfig"),function(b,d){return d.id===a?(c=d,!1):void 0}),c},_getModuleId:function(a){var b=this.get("modulesConfig");return b[a]?b[a].id:a},_getCurrentPageId:function(){var a=this,b=a._getCurrentModuleId(),c=a._getModule(b),d="";if(c){var e=c.menu.getSelected();e&&(d=e.get("id"))}return d},_getCurrentModuleId:function(){return this._getModuleId(this.get("currentModelIndex"))},_isModuleInitial:function(a){return!!this.get("modules")[a]},_setLastItem:function(a){var b=this,c=b.get("lastShowItem");if(c!==a){var d=null,e=$(c);itemEl=$(a),c&&(d=e.find("."+w),e.removeClass(q),e.addClass(p)),itemEl.addClass(q),itemEl.removeClass(p),d||(d=$('<span class="icon icon-white  icon-caret-down '+w+'">&nbsp;&nbsp;</span>')),d.appendTo(itemEl.children(".nav-item-inner")),b.set("lastShowItem",a)}},_setModuleSelected:function(a,b){var c=this,d=c.get("navItems"),f=c.get("navTabs"),g=c.get("currentModelIndex");if(g!==a){var h=c._getModuleId(a),i=null,j=c.get("lastShowItem"),k=!0;c._isModuleInitial(h)||(k=!1),i=c._getModule(h),b=b||$(c.get("navItems")[a]),b.hasClass(p)&&j&&(c._setLastItem(b[0]),c._setSelectHideItem(a)),d.removeClass(o),b.addClass(o),f.addClass(p),$(f[a]).removeClass(p),g=a,c.set("currentModelIndex",g),curPageId=c._getCurrentPageId(),e(h,curPageId),!curPageId&&i.homePage&&c._setPageSelected(a,i.homePage)}},_setPageSelected:function(a,b,d,e){var f=this,g=f._getModuleId(a)||a,h=f._getModule(g);if(h&&b){h.menu.setSelectedByField(b);var i=h.menu.getSelected(),j=h.tab,k="",l=-1;if(i&&i.get("id")===b)k=i.get("href"),k=e?c(k,e):k,h.tab.addTab({id:i.get("id"),title:i.get("text"),closeable:i.get("closeable"),href:k},!!d);else if(b){var m=b.replace("-","/");-1===m.indexOf("/")&&(m=g+"/"+m),-1===(l=b.indexOf("."))&&(m+=f.get("urlSuffix")),k=e?m+"?"+e:m,j.addTab({id:b,title:"",href:k},!!d)}}},_showHideList:function(a){var b=this,c=b.get("hideList");c.css("left",a.left),c.css("top",a.top),c.show()},_setSelectHideItem:function(a){var b=this,c=b.get("hideList"),d=b.get("hideItmes"),e=null,f=null,g=null,h=null;BUI.each(d,function(b){var c=$(b);c.attr(x)==a&&(f=b),c.hasClass(q)&&(e=b)}),e!==f&&(e&&(h=$(e).find(".dl-hide-current"),$(e).removeClass(q)),$(f).addClass(q),h||(h=new Node('<span class="dl-hide-current">&nbsp;&nbsp;</span>')),g=$(f),h.appendTo(g.children(".nav-item-inner")),g.prependTo(c))}}),l.MainPage=z,z});